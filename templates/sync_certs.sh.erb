#!/bin/bash
# This file is managed by Puppet
SCRIPTNAME=$(basename $0)

logger "PE_FAILOVER: ${SCRIPTNAME} ---> Starting sync of Puppet CA directory to <%= @passive_master %>"

<%= @rsync_command %> \
  -e '/usr/bin/ssh -i <%= @rsync_user_ssh_id %>' \
  <% @merged_exclude_certs.each do |cert| -%>
  --exclude='<%= cert %>' \
  <% end -%>
  <%= @rsync_ssl_dir %> <%= @rsync_user %>@<%= @passive_master %>:<%= @rsync_ssl_dir %>

result="$?"
if [[ $result -eq 0 ]]; then
  logger "PE_FAILOVER: ${SCRIPTNAME} ---> Completed sync of Puppet CA directory to <%= @passive_master %>"
else
  logger "PE_FAILOVER: ${SCRIPTNAME} ---> Failed to sync. Exit code is: ${result}"
fi
